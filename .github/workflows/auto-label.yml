name: "Auto Assign Hacktoberfest Label"

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Create Hacktoberfest label if missing and assign
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          LABEL_NAME="Hacktoberfest"
          LABEL_COLOR="#0DAB76"  # Green

          # Create label if it doesn't exist
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${GITHUB_REPOSITORY}/labels \
            -d "{\"name\":\"$LABEL_NAME\",\"color\":\"$LABEL_COLOR\"}")

          if [[ "$response" == "422" ]]; then
            echo "Label '$LABEL_NAME' already exists, skipping."
          else
            echo "Label '$LABEL_NAME' created."
          fi

          # Assign Hacktoberfest label to issue or PR
          ISSUE_NUMBER="${{ github.event.issue.number || github.event.pull_request.number }}"
          curl -s -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${GITHUB_REPOSITORY}/issues/$ISSUE_NUMBER/labels \
            -d "{\"labels\":[\"$LABEL_NAME\"]}"

          echo "Label assigned: $LABEL_NAME"
